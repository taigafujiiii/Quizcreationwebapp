# クイズアプリ 仕様・要件

## 概要
- 学習者向けのクイズ学習アプリと、管理者向けの管理機能を備える。
- コースは「自由演習」と「課題」の2種類。
- 画面遷移は `react-router-dom` によるSPA構成。
- 現行実装はモックデータとフロントのみの状態管理（永続化なし）。

## 役割と権限
- `admin`
- すべての単元にアクセス可能。
- 管理者向けの管理画面にアクセス可能。
- `user`
- 管理者が許可した単元のみ学習可能（`allowedUnitIds`）。
- 管理画面にはアクセス不可。

## 主要ルート
- `/login` ログイン
- `/accept-invite` 招待登録
- `/verify` メール認証
- `/forgot` パスワード再設定
- `/reset-password` パスワード更新
- `/` ユーザーホーム（コース選択）
- `/quiz/setup` 自由演習の条件設定
- `/quiz` クイズ実行
- `/result` 結果
- `/assignment/units` 課題コースの単元選択
- `/assignment/categories/:unitId` 課題コースのカテゴリ選択
- `/admin` 管理者ダッシュボード
- `/admin/units` 単元管理
- `/admin/categories` カテゴリ管理
- `/admin/questions` 問題管理
- `/admin/assignments` 課題管理
- `/admin/users` ユーザー管理

## 認証・招待
- ログイン
- メール/パスワードでログイン。
- メールアドレスに `admin` を含む場合は管理者扱い（モック判定）。
- 招待登録
- `/accept-invite` に `token`、`email`、`role` をクエリとして受け取る想定。
- `token` 状態に応じて「有効/期限切れ/無効/使用済み」を表示。
- ユーザー名（最大50文字）とパスワード（8文字以上、確認一致）が必須。
- 登録後はログイン画面へ遷移し完了メッセージを表示。
- メール認証
- `/verify` で認証中/成功/失敗を表示（現状は成功に遷移するモック）。
- パスワード再設定
- `/forgot` でメール送信完了を表示（モック）。

## ユーザー機能
### ホーム（コース選択）
- 自由演習コース: 出題モード・範囲・問題数を自由に設定。
- 課題コース: 指定カテゴリの課題問題に取り組む。

### 自由演習コース（`/quiz/setup`）
- 出題モード
- 単元指定（単元配下のカテゴリ全体）
- カテゴリ指定（特定カテゴリ）
- 複数カテゴリ指定（同一単元内の複数カテゴリ）
- 出題数: 10/20/30/40/50 問
- 権限制御
- `user` は `allowedUnitIds` に含まれる単元のみ選択可能。
- 許可単元が0件の場合は警告表示。

### 課題コース
- 単元選択 -> カテゴリ選択の2段階。
- カテゴリに課題問題が存在しない場合は選択不可。
- 選択したカテゴリの「課題問題のみ」を全問出題。

## クイズ仕様
- 選択式（A/B/C/D） + 「わからない」
- 進捗表示（何問目/全体、%）
- 次へ/結果を見る
- 前の問題には戻れない。
- クイズ途中にホームへ戻ると進捗は破棄（確認モーダル表示）。
- 出題対象
- `isActive` が `true` の問題のみ出題。
- 課題コースでは `isAssignment` が `true` の問題のみ。
- 自由演習では条件に合う問題をシャッフルし、指定数だけ出題。

## 結果表示
- 正解数、正答率を表示。
- 問題ごとの正誤、選択肢、正解、解説を表示。

## 管理者機能
### 管理者ダッシュボード
- 単元管理、カテゴリ管理、問題管理、課題管理、ユーザー管理に遷移。
- 管理者招待モーダルを提供。

### 単元管理
- 単元の作成/編集/削除。
- 項目: `name`, `description`

### カテゴリ管理
- カテゴリの作成/編集/削除。
- 所属単元を選択。
- 単元別フィルタ（カード/スクロール）で絞り込み。

### 問題管理
- 問題の作成/編集/削除。
- 項目: 問題文、選択肢A-D、正解、解説、カテゴリ、公開/非公開。
- `isActive` の ON/OFF で出題対象を切替。

### 課題管理
- 課題問題の一覧、フィルタ（単元/カテゴリ）。
- 課題問題の新規作成。
- 既存問題を課題に追加/削除。
- 課題問題の編集。

### ユーザー管理
- ユーザー一覧・検索（メール/ユーザー名）・ロールフィルタ。
- 削除済みユーザーの表示切替。
- ユーザー編集
- ユーザー名編集（最大50文字）。
- 学習可能単元の設定（`user` のみ）。
- ユーザー削除（`isActive = false`）
- ユーザー招待
- 招待メール送信（モック）。
- ロール選択（`admin`/`user`）。
- `user` の場合は学習可能単元を設定。

## データモデル（現行）
- User
- `id`, `email`, `role`, `verified`, `isActive`, `createdAt`, `username`, `allowedUnitIds`
- Unit
- `id`, `name`, `description`
- Category
- `id`, `name`, `description`, `unitId`
- Question
- `id`, `text`, `optionA/B/C/D`, `correctAnswer`, `explanation`, `categoryId`, `isActive`, `isAssignment`
- QuizAnswer
- `questionId`, `userAnswer`
- QuizResult
- `questionId`, `questionText`, `userAnswer`, `correctAnswer`, `isCorrect`, `explanation`

## UI/UX要件
- レスポンシブ対応（モバイル/デスクトップ）。
- ダイアログ/トースト/バッジ等で状態を明示。
- ヘッダーにユーザー情報とログアウトを表示。

## 現行実装の前提・制限
- Supabaseを利用した永続化・認証を実装済み。
- 進捗や成績の保存は未実装。